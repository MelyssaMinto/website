---
title: Invasion of Privacy - A Data Science Approach
author: Melyssa Minto
date: '2018-04-23'
slug: invasion-of-privacy-a-data-science-approach
categories: [R]
tags: [tidytext, tidyR, CardiB]
output:
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
---


### Motivation
This work was inspired by [Julia Silge](https://twitter.com/juliasilge) and of course [Cardi B](https://twitter.com/iamcardib). Julia Silge recently came to Duke and gave a [#RLadies](https://twitter.com/hashtag/RLadies?src=hash) [#tidytext](https://twitter.com/hashtag/tidytext?src=hash) workshop, before this I have actively avoided the tidy principles because I was stuck in my old ways.

<http>
<center>
![](https://j.gifs.com/PZ82GW.gif)
</center>
</http>


But you wanna know something, it has been really fun learning the tidy principles and exceptionally easy to follow. 


**Keys to being tidy**

+ First thing's first, ```%>%``` is the pipe operator. At first, looking at "tidy" code with the pipe operator can make ```R``` look like a _whole_ other programming language. But once I understood that it was just piping through each step one line at a time, things started to clear up. 

+ Comment your code!!!
<http>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">“I comment my code as if at any moment I might get a traumatic brain injury”<a href="https://twitter.com/dataandme?ref_src=twsrc%5Etfw">@dataandme</a> at <a href="https://twitter.com/hashtag/rstatsnyc?src=hash&amp;ref_src=twsrc%5Etfw">#rstatsnyc</a></p>&mdash; David Robinson (@drob) <a href="https://twitter.com/drob/status/987795355659112453?ref_src=twsrc%5Etfw">April 21, 2018</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> 
</http>

+  For more information, please visit the [tidyverse](https://www.tidyverse.org) website, I am a newbie to this.


```{r, message = FALSE, warning=FALSE, echo = FALSE}
### Data Preprocessing
require(tidytext)
require(tidyverse) 
require(readr)
require(dplyr)
require(purrr)
require(reshape2)
require(wordcloud)
require(stm)
require(quanteda)
require(knitr)
require(widyr)
require(igraph)
require(ggraph)
require(stringr)
```

```{r,message = FALSE, warning=FALSE, echo = FALSE}
setwd("~/Dropbox/blogfiles/CardiB/")
filepath <- list.files("~/Dropbox/blogfiles/CardiB/InvasionofPrivacy/", pattern="*.txt", full.names=TRUE)
ldf <- lapply(filepath, function(x) read_delim(x,  "\t", escape_double = FALSE, trim_ws = TRUE, col_names = FALSE))

#--tidy dataset
#-Extract song names
titles <- gsub("/Users/LabWork/Dropbox/blogfiles/CardiB/InvasionofPrivacy//", "", filepath)
titles <- gsub("-", " ", titles)
titles <- gsub(".txt", "", titles)
#titles

#-adding title and line number to each dataframe
names(ldf)<-titles #name each element in list 

#Making a color pallete based on the album cover
                   
IoP_pallete<-c("#005473", # deepteal 
               "#F4FCFF", # white
               "#15152D", # black
               "#4B556E", # blue-grey
               "#5E0151", # purple
               "#F3FC03", # yellow
               "#885913", # brown
               "#F388AA", # pink
               "#EE0500", # red
               "#2FA7BF", # teal
               "#DEBA04", # golden
               "#AEDEEC", # babyblue
               "#E6AE8B") # tan
```

```{r, message = FALSE}

#ldf is a list of dataframes and each dataframe represents a song on the album
ldf<-mapply(`[<-`, ldf, 'Title', value = titles, SIMPLIFY = FALSE) #add a title column in each dataframe in list
ldf<-lapply(names(ldf), function(x) tibble::rowid_to_column(ldf[[x]], "line")) #add line number column

#-put all songs in one datafame 
full_album <- bind_rows(ldf) 
colnames(full_album)[2] <- "text"

#-tidy it!
tidy_album <- full_album %>%
  unnest_tokens(word, text)
```


### Sentiment analysis
#### What kinda vibe is Cardi B's album _Invasion of Privacy_ giving off?

Here I used ```bing``` sentiments which classify if a word is positive or negative.

```{r, message=FALSE, fig.align='center', echo=FALSE, warning = FALSE}
tidy_album %>%
  anti_join(stop_words) %>% #remove stop words
  inner_join(get_sentiments("bing")) %>% #add sentiment 
  count(word, sentiment, sort = TRUE) %>% #count the sentiments 
  acast(word ~ sentiment, value.var = "n", fill = 0) %>% 
  comparison.cloud(colors = IoP_pallete[c(1,8)],max.words = 300,title.size=1)
```

Using this classification, I looked to see what percent of each song was positive or negative. This analysis shows that _Best Life_, _I Like It_ , _Money Bag_, _I Do_ are the top positive songs. I will have to agree that _Best Life_ and _I like It_ are overall positive, and _Best Life_ features [Chance The Rapper](https://twitter.com/chancetherapper), my all-time favorite artist, so it will always hold a special place in my heart.


```{r,message=FALSE, warning = FALSE}
album_sentiment<-tidy_album %>%
  anti_join(stop_words) %>%
  inner_join(get_sentiments("bing")) %>%   # getting the subset of words that are in the bing sentiment and in the album
  count(Title, word, sentiment, sort = TRUE) %>% # counting the number of positive and negative sentiments in each song
  group_by(Title) %>%
  mutate(proc = (n/sum(n) * 100)) %>%      #calcalating percent of positive and negative sentiments
  ungroup 
```

<http>
<center>
```{r, fig.height=7, fig.width=12, message=FALSE, echo=FALSE, warning = FALSE}
album_sentiment %>%
  ggplot(aes(factor(1), proc, fill = sentiment)) + #plotting 
  geom_bar(width = 1, stat = "identity")+
  scale_fill_manual(values=IoP_pallete[c(1,8)]) +
  theme(panel.background = element_blank()) +
  coord_polar("y", start=0)+
  facet_wrap(~Title) +
  labs(x="", y="")
```
</center>
</http>

I was curious to see what words from those songs made it "positive".
```{r, message=FALSE, warning = FALSE}
album_pos<-album_sentiment %>%
  filter(Title %in% c("I Like It", "Best Life", "Money Bag", "I Do")) %>% #subsetting the four songs
  group_by(Title) %>%
  filter(row_number() <= 10)   %>% #get top 10 sentiments for each song
  ungroup() 
```

```{r, message=FALSE, fig.align='center', echo=FALSE, warning = FALSE}
album_pos %>%
  ggplot(aes(reorder(word,n), n, fill = sentiment)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values=IoP_pallete[c(1,8)]) +
  facet_wrap(~Title, scales = "free", ncol = 2) +
  theme(panel.background = element_blank()) +
  labs(y = "Contribution to sentiment", x = NULL) +
  coord_flip()
```

Let's just take a moment to appreciate that "woo" is a positive word! Otherwise, I would think a better sentiment data set would better serve these songs, one specific to hip-hop music. 

### tf-idf analysis 
#### Soooo you haven't listened to the album yet...I will try and summarize each song


+ term frequency (tf) and inverse document frequency (idf) have been theorized to score words that best describe text
$$ idf(term) = ln( \frac{n_{\text{documents}}}{n_{\text{douments containing term}}})$$

+ tf-idf is about comparing text within a collection, finds word that are most important in each document in a collection

So let's see if this reigns true for the songs in the album. Naturally, the words that are most important to each song is the chorus which typically defines the song. 
```{r, message=FALSE, warning = FALSE }
album_tf_idf<-tidy_album %>% 
  count(Title, word, sort = TRUE) %>% #count the words
  bind_tf_idf(word, Title, n) %>% #calculate tf_idf score
  arrange(desc(tf_idf)) %>% #sort by tf_idf
  group_by(Title) %>% 
  filter(row_number() <= 10)   %>% #get the top 10 tf_idf for each song
  ungroup 
```

```{r, message=FALSE,fig.height=10, fig.align='center', echo =FALSE, warning = FALSE}
album_tf_idf %>%
  ggplot(aes(fct_reorder(word, tf_idf), tf_idf, fill = Title)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values=IoP_pallete) +
  labs(x = NULL, y = "tf-idf") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~Title, ncol = 2, scales = "free") +
  coord_flip()
```

If I took the words of the highest tf-idf score for each song, I wouldn't be able to recapitulate what the song was about. Perhaps, calculating the tf-idf scores on n grams would better characterize what the song was about.

### Analyzing n-grams

```{r, message=FALSE, warning = FALSE,, eval=FALSE, echo=FALSE }
bigram_album <- full_album %>%
  unnest_tokens(bigram, text, token = "ngrams", n=2) %>%
  separate(bigram, c("word1", "word2"), sep = " " ) %>% #separate words
  filter( !word1 %in% c("verse", "chorus", "intro"), # filter out "verse", "chorus", and "intro"
          !word2 %in% c("verse", "chorus", "intro")) %>% 
  unite(bigram, word1, word2, sep = " ") %>%  #join words
  count(Title, bigram) %>%
  bind_tf_idf(bigram, Title, n) %>%
  arrange(desc(tf_idf)) %>%
  group_by(Title) %>% 
  filter(row_number() <= 10)   %>%
  ungroup

```

 
```{r,  message=FALSE, fig.height = 10, fig.align='center', echo=FALSE, warning = FALSE, eval=FALSE }
bigram_album %>%
  ggplot(aes(fct_reorder(bigram, tf_idf), tf_idf, fill = Title)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values=IoP_pallete) +
  labs(x = NULL, y = "tf-idf") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~Title, ncol = 2, scales = "free") +
  coord_flip()
```

Here are the top trigrams for each song.
```{r, message=FALSE, warning = FALSE}
trigram_album<-full_album %>%
  unnest_tokens(trigram, text, token = "ngrams", n=3) %>%
  separate(trigram, c("word1", "word2", "word3"), sep = " " ) %>% #separate words
  filter( !word1 %in% c("verse", "chorus", "intro"), # filter out "verse", "chorus", and "intro"
          !word2 %in% c("verse", "chorus", "intro"),
          !word3 %in% c("verse", "chorus", "intro")) %>% 
  unite(trigram, word1, word2, word3, sep = " ") %>%  # join words
  count(Title, trigram) %>% # counting the trigrams
  bind_tf_idf(trigram, Title, n) %>% # calculate tf_idf for the trigrams
  arrange(desc(tf_idf)) %>% # sort by tf_idf
  group_by(Title) %>% 
  filter(row_number() <= 10)   %>% #get the top 10 for each song
  ungroup


```

```{r,  message=FALSE, fig.height = 10, fig.align='center', echo=FALSE, warning = FALSE}
trigram_album %>%
  ggplot(aes(fct_reorder(trigram, tf_idf), tf_idf, fill = Title)) +
  geom_col(show.legend = FALSE) +
  scale_fill_manual(values=IoP_pallete) +
  labs(x = NULL, y = "tf-idf") +
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +
  facet_wrap(~Title, ncol = 2, scales = "free") +
  coord_flip()
```

I definitely think as n increases, it is easier to get a picture of what each song is about. The top trigrams of _Drip_, _Best Life_, _Get Up 10_ characterizes its respective song well. 

#### Cardi B Phrases

We all know Cardi B is known for her phrases, so I was curious to see what are some top phrases we can take from the album. 

<http>
<center>
<iframe src="https://giphy.com/embed/3o751Yxe9UjX26BZbG" width="480" height="358" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>

<iframe src="https://giphy.com/embed/12sHg8v0G84V20" width="480" height="270" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>

<iframe src="https://giphy.com/embed/xUydljLrnX00Dm59dH" width="480" height="433" frameBorder="0" class="giphy-embed" allowFullScreen></iframe>
</center>
</http>

Below is a graph of bigrams throughout the album. 
```{r , message=FALSE, echo=FALSE, warning = FALSE}
count_bigrams <- function(dataset) {
  dataset %>%
    unnest_tokens(bigram, text, token = "ngrams", n = 2) %>%
    separate(bigram, c("word1", "word2"), sep = " ") %>%
    filter(!word1 %in% c(stop_words$word, "verse", "chorus", "intro"),
           !word2 %in% c(stop_words$word, "verse", "chorus", "intro")) %>%
    count(word1, word2, sort = TRUE)
}

visualize_bigrams <- function(bigrams) {
  set.seed(2016)
  a <- grid::arrow(type = "closed", length = unit(.15, "inches"))
  
  bigrams %>%
    graph_from_data_frame() %>%
    ggraph(layout = "fr") +
    geom_edge_link(aes(edge_alpha = n), show.legend = FALSE, arrow = a) +
    geom_node_point(color = "lightblue", size = 5) +
    geom_node_text(aes(label = name), vjust = 1, hjust = 1) +
    theme_void()
}


bigrams <- full_album %>%
  count_bigrams()

# filter out rare combinations, as well as digits
bigrams %>%
  filter(n > 2,
         !str_detect(word1, "\\d"),
         !str_detect(word2, "\\d")) %>%
  visualize_bigrams()
```


<html>
<div id="qp_all1939111" style="width:100%;">
<link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'><STYLE>#qp_main1939111 .qp_btna:hover input {background:#00355F!important} #qp_all1939111 {max-width:815px; margin:0 auto;}
</STYLE>
<div id="qp_main1939111" fp='e6Df47D6-53' results=0 cmt=0 style="border-radius:0px;margin:0 auto;padding:0.8em;background-color:#FFF;font-family: 'Open Sans', sans-serif, Arial;color:#000;border: 1px solid #DBD9D9;max-width:815px;box-sizing:border-box"><div style="font-size:1.2em;background-color:#00355F;color:#FFF;font-family:'Open Sans', sans-serif, Arial"><div style="padding:0.8em;line-height:1.3em">Can anyone spot the next Cardi B catch phrase?</div></div><form id="qp_form1939111" action="//www.poll-maker.com/results1939111xe6Df47D6-53" method="post" target="_blank" style="display:inline;margin:0px;padding:0px"><div style="padding:0px"><input type=hidden name="qp_d1939111" value="43214.5190740794-43214.5190824753"><div style="display:block;color:#6B6B6B;font-family: 'Open Sans', sans-serif, Arial;font-size:1.1em;line-height:1.5;padding:13px 8px 11px;margin:10px 0px;clear:both" class="qp_a" onClick="var c=this.getElementsByTagName('INPUT')[0]; if((!event.target?event.srcElement:event.target).tagName!='INPUT'){c.checked=(c.type=='radio'?true:!c.checked)};var i=this.parentNode.parentNode.parentNode.getElementsByTagName('INPUT');for(var k=0;k!=i.length;k=k+1){i[k].parentNode.parentNode.setAttribute('sel',i[k].checked?1:0)}"><span style="display:block;padding-left:30px;cursor:inherit"><input style="float:left;width:20px;margin-left:-25px;margin-top:2px;padding:0px;height:20px;-webkit-appearance:radio;" name="qp_v1939111" type="radio" value="1" />#FerrariFridays</span></div><div style="display:block;color:#6B6B6B;font-family: 'Open Sans', sans-serif, Arial;font-size:1.1em;line-height:1.5;padding:13px 8px 11px;margin:10px 0px;clear:both" class="qp_a" onClick="var c=this.getElementsByTagName('INPUT')[0]; if((!event.target?event.srcElement:event.target).tagName!='INPUT'){c.checked=(c.type=='radio'?true:!c.checked)};var i=this.parentNode.parentNode.parentNode.getElementsByTagName('INPUT');for(var k=0;k!=i.length;k=k+1){i[k].parentNode.parentNode.setAttribute('sel',i[k].checked?1:0)}"><span style="display:block;padding-left:30px;cursor:inherit"><input style="float:left;width:20px;margin-left:-25px;margin-top:2px;padding:0px;height:20px;-webkit-appearance:radio;" name="qp_v1939111" type="radio" value="2" />#BadBunny</span></div><div style="display:block;color:#6B6B6B;font-family: 'Open Sans', sans-serif, Arial;font-size:1.1em;line-height:1.5;padding:13px 8px 11px;margin:10px 0px;clear:both" class="qp_a" onClick="var c=this.getElementsByTagName('INPUT')[0]; if((!event.target?event.srcElement:event.target).tagName!='INPUT'){c.checked=(c.type=='radio'?true:!c.checked)};var i=this.parentNode.parentNode.parentNode.getElementsByTagName('INPUT');for(var k=0;k!=i.length;k=k+1){i[k].parentNode.parentNode.setAttribute('sel',i[k].checked?1:0)}"><span style="display:block;padding-left:30px;cursor:inherit"><input style="float:left;width:20px;margin-left:-25px;margin-top:2px;padding:0px;height:20px;-webkit-appearance:radio;" name="qp_v1939111" type="radio" value="3" />#MoneyMoves</span></div><div style="display:block;color:#6B6B6B;font-family: 'Open Sans', sans-serif, Arial;font-size:1.1em;line-height:1.5;padding:13px 8px 11px;margin:10px 0px;clear:both" class="qp_a" onClick="var c=this.getElementsByTagName('INPUT')[0]; if((!event.target?event.srcElement:event.target).tagName!='INPUT'){c.checked=(c.type=='radio'?true:!c.checked)};var i=this.parentNode.parentNode.parentNode.getElementsByTagName('INPUT');for(var k=0;k!=i.length;k=k+1){i[k].parentNode.parentNode.setAttribute('sel',i[k].checked?1:0)}"><span style="display:block;padding-left:30px;cursor:inherit"><input style="float:left;width:20px;margin-left:-25px;margin-top:2px;padding:0px;height:20px;-webkit-appearance:radio;" name="qp_v1939111" type="radio" value="4" />Nothing will beat #Okuurrrr</span></div></div><div style="padding-left:0px;clear:both;text-align:left;margin:1em auto"><a style="display:inline-block;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;-o-box-sizing:border-box;padding-right:5px;text-decoration:none" class="qp_btna" href="#"><input name="qp_b1939111" style="min-width:7.8em;padding:0.5em;background-color:#0B79D3;font-family: 'Open Sans', sans-serif, Arial;font-size:16px;color:#FFF;cursor:pointer;cursor:hand;border:0px;-webkit-appearance:none;border-radius:0px" type="submit" btype="v" value="Vote" /></a><a style="display:inline-block;box-sizing:border-box;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;-ms-box-sizing:border-box;-o-box-sizing:border-box;padding-left:5px;text-decoration:none" class="qp_btna" href="#"><input name="qp_b1939111" style="min-width:7.8em;padding:0.5em;background-color:#0B79D3;font-family: 'Open Sans', sans-serif, Arial;font-size:16px;color:#FFF;cursor:pointer;cursor:hand;border:0px;-webkit-appearance:none;border-radius:0px" type="submit" btype="r" value="Results" /></a></div></form><div style="display:none"><div id="qp_rp1939111" style="font-size:14px;width:5ex;text-align:right;overflow:hidden;position:absolute;right:5px;height:1.5em;line-height:1.5em"></div><div id="qp_rv1939111" style="font-size:14px;line-height:1.5em;width:0%;text-align:right;color:#FFF;box-sizing:border-box;padding-right:3px"></div><div id="qp_rb1939111" style="font-size:14px;line-height:1.5em;color:#FFFFFF;display:block;padding-right:10px 5px"></div><div id="qp_rva1939111" style="background:#006FB9;border-color:#006FB9"></div><div id="qp_rvb1939111" style="background:#163463;border-color:#163463"></div><div id="qp_rvc1939111" style="background:#5BCFFC;border-color:#1481AB"></div></div></div><div style='text-align:center; margin:5px;'>Created with <a id="qp_foot1939111" href="http://pollmaker.vote/e/RHEMFLE6">Survey Maker</a></div></div><script src="//scripts.poll-maker.com/3012/scpolls.js" language="javascript"></script>
</html>

I can't wait till I'm making ___money moves___ and make a ___couple m's___ ... I'm not sure if I will be buying ___red bottoms___ or a ___versace driveway___ but I'm definitely okay with ___ferrari fridays___.

### Summary
Using tidy principles definitely made my code look and feel more neat and debugging was a lot easier. I will be incorporating tidy principles more in my day to day work. As for text mining and analysis, this was my first jab at it and I had a lot of fun with this. I think a better sentiment dataset that is catered to Rap/Hip-Hop music would have made the sentiment analysis more accurate. Thank you for reading my first blog post...now back to [#PhDLife](https://twitter.com/hashtag/phdlife?src=hash&lang=en). 

### Resources 
+ [Converting to and from Document-Term Matrix and Corpus objects](https://cran.r-project.org/web/packages/tidytext/vignettes/tidying_casting.html)

+ [Text Mining with R](https://www.tidytextmining.com)

+ [Topic modeling with R and tidy data principles](https://www.youtube.com/watch?v=evTuL-RcRpc)

+ [Tutorials for Text Mining Using Tidy Data Principles](https://github.com/juliasilge/tidytext-tutorial)

